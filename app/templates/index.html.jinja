{% extends "layout.html.jinja" %}
{% set active_page = "index" %}
{% block title %}Home{% endblock %}
{% block header %}Stack Overflow Data Dashboards{% endblock %}
{% block main_name %}index{% endblock %}
{% block content %}
	<section id="stats-box" class="grid-panel grid-w-12">
		<div class="grid-w-3 grid-sw-12 bg-light text-dark">
			<p class="text-center">Data taken between <i class="fa-solid fa-calendar"></i></p>
			<p><span class="stats-figure"><span class="text-purple-light">{{ data['question_date_range']['data'][0] }} {{ data['question_date_range']['data'][1] }}</span></p>
		</div>
		<div class="grid-w-6 grid-sw-12 bg-light text-dark">
			<p><span class="text-purple-light">{{ data['table_row_count']['data']['question'] }}</span> Questions</p>
			<p><span class="text-purple-light">{{ data['table_row_count']['data']['answer'] }}</span> Answers</p>
			<p><span class="text-purple-light">{{ data['table_row_count']['data']['comments'] }}</span> Comments</p>
			<p><span class="text-purple-light">{{ data['table_row_count']['data']['tag_link']}}</span> Tags</p>
		</div>
		<div class="grid-w-3 grid-sw-12 bg-light text-dark">
			<p><span class="text-purple-light">{{ data['table_row_count']['data']['user'] }}</span> Users</p>
			<p><span class="text-purple-light">{{ data['table_row_count']['data']['badge_link'] }}</span> Badges</p>
		</div>
	</section>
	<section id="post-box" class="grid-panel bg-light grid-w-6 grid-sw-12">
		<h1 class="grid-w-5 grid-sw-10 text-left">Question tags</h1>
		<div class="grid-w-1 grid-sw-2 button-wrapper">
			<button class="btn-green index-tag" id="more-tags"><i class="fa-solid fa-plus"></i></button>
			<button class="btn-red index-tag" id="less-tags"><i class="fa-solid fa-minus"></i></button>
		</div>
		<div class="grid-w-6 grid-sw-12 canvas-wrapper" id="tags-box">
			<canvas id="tagChart" aria-label="Tags chart" role="img"></canvas>
		</div>
		<h1 class="grid-w-3 grid-sw-12 text-center">Unanswered questions</h1>
		<div class="grid-w-3 grid-sw-12 canvas-wrapper" id="question-wrapper">
			<canvas id="questionChart" aria-label="Unanswered questions" role="img"></canvas>
		</div>
		<h1 class="grid-w-3 grid-sw-12 text-center" id="answer-header">Answer Acceptance Rate</h1>
		<div class="grid-w-3 grid-sw-12 canvas-wrapper">
			<canvas id="acceptanceChart" aria-label="Answer acceptance rate" role="img"></canvas>
		</div>
	</section>
	<section id="user-box" class="grid-panel grid-w-6 grid-sw-12 bg-light">
		<p class="grid-w-12"> {{data | pprint }}</p>
	</section>
{% endblock %}
{% block scripts %}
	<script>
		let tag_count = {{ data['top_tags']['data']['tags'] | length }};
		let acceptance = [
			{{ data['question_details']['data'][0] }},
			{{ data['question_details']['data'][1] }},
			{{ data['table_row_count']['data']['question'] }} - {{ data['question_details']['data'][0] }} - {{ data['question_details']['data'][1] }}
		];
		const tag_ctx = document.getElementById('tagChart');
		const accept_ctx = document.getElementById('acceptanceChart');
		const index_tag_chart = createChart(tag_ctx,'bar','Questions with this tag',{{ data['top_tags']['data']['tags'] | tojson }},{{ data['top_tags']['data']['count'] | tojson }},'');
		const accept_doughnut_chart = createChart(accept_ctx, 'doughnut','',['Unanswered','Not Accepted', 'Accepted'],acceptance,'');
		document.querySelectorAll('.index-tag').forEach(el => el.addEventListener('click', e => {
			tag_count = (e.target && (e.target.id || e.target.parentNode.id) == 'more-tags' ? tag_count + 5 : (e.target && (e.target.id || e.target.parentNode.id) == 'less-tags' ? tag_count - 5 : false));
			if(tag_count) {
				result = index_tag_asyncCall();
			} else {
				document.getElementById('tags-box').innerHTML = '<h1 class="grid-w-9 grid-sw12 text-red">An error occured, if the problem persists please contact the administration staff<h1>';
			}
		}));
	</script>
{% endblock %}
